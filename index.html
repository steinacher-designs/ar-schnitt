<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>AR Overlay â€“ Hausquerschnitt</title>
<script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
<style>
  html, body {
    margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden;
    background-color: #000;
  }
  a-scene {
    width: 100%; height: 100%; position: absolute; top: 0; left: 0;
  }
</style>
</head>
<body>

<!-- === AR SCENE === -->
<a-scene
  mindar-image="imageTargetSrc: ./assets/hausschnitt.mind; filterMinCF: 0.0001; filterBeta: 0.05;"
  embedded
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: true"
>
  <a-camera position="0 0 0"></a-camera>

  <!-- When the target image is detected, attach the 3D overlay -->
  <a-entity mindar-image-target="targetIndex: 0">
    <!-- Wrapper for stabilizing the model -->
    <a-entity id="overlayWrapper" position="1 0.3 -0.1" rotation="0 180 0" stabilize-rotation="strength:0.2">
      <a-gltf-model
        id="schnittModel"
        src="./assets/schnitt.glb"
        scale="1 1 1"
        shadow="receive: false; cast: false"
      ></a-gltf-model>
    </a-entity>
  </a-entity>
</a-scene>

<script>
  // === Stabilize small rotation jitters ===
  AFRAME.registerComponent('stabilize-rotation', {
    schema: { strength: {default: 0.1} },
    tick: function () {
      const rot = this.el.object3D.rotation;
      rot.x *= (1 - this.data.strength);
      rot.z *= (1 - this.data.strength);
    }
  });

  // === Basic tracking events ===
  const target = document.querySelector("[mindar-image-target]");
  target.addEventListener("targetFound", () => {
    console.log("ðŸ“¸ Bild erkannt â€“ Overlay aktiviert");
  });
  target.addEventListener("targetLost", () => {
    console.log("âŒ Bild verloren â€“ Overlay ausgeblendet");
  });

  // === Start camera on user interaction (iOS fix) ===
  document.body.addEventListener("click", () => {
    const scene = document.querySelector("a-scene[mindar-image]");
    if (scene && scene.components["mindar-image"]) {
      try { scene.components["mindar-image"].start(); } catch(e) { console.warn(e); }
    }
  }, { once: true });
</script>

</body>
</html>
